/*! For license information please see 1307.e22e0c15.js.LICENSE.txt */
"use strict";(self.webpackChunkimg2go=self.webpackChunkimg2go||[]).push([[1307],{41307:function(e,t,r){r.d(t,{lM:function(){return O},p4:function(){return D}});r(52675),r(89463),r(66412),r(2259),r(78125),r(23792),r(94490),r(34782),r(62010),r(4731),r(60479),r(40875),r(10287),r(26099),r(3362),r(27495),r(47764),r(71761),r(25440),r(23500),r(62953),r(76031);var n=r(80209),o=r(43311),i=r(44171),a=r(69461),s=(r(50113),r(27588)),u=r(55397),p=r(60169);function c(e){this._isValid=!0,this._rawData={},(0,u.Jr)(e)?this._rawData=e:this._isValid=!1}c.prototype.isValid=function(){return this._isValid},c.prototype.getId=function(){return(0,n.jO)(this._isValid),this._rawData.id},c.prototype.getSize=function(){return(0,n.jO)(this._isValid),this._rawData.size},c.prototype.getStatus=function(){return(0,n.jO)(this._isValid),(0,o.PT)(this._rawData.status),this._rawData.status},c.prototype.isFinished=function(){return(0,n.jO)(this._isValid),this._rawData.status===p.pk};r(79432);function l(e){if(!(0,i.UN)(e))return e;try{var t=JSON.parse(e);if((0,i.Q2)(t))return a.q.log("qgApiHelper server response was fixed",JSON.stringify(e)),t}catch(e){}return a.q.log("qgApiHelper server response was not fixed",JSON.stringify(e)),e}var f=r(54301),d=r(90703),h=r(32442),g=r(63528),v=r(74692);function y(e){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y(e)}function b(){b=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function p(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{p({},"")}catch(e){p=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var i=t&&t.prototype instanceof m?t:m,a=Object.create(i.prototype),s=new U(n||[]);return o(a,"_invoke",{value:C(e,r,s)}),a}function l(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=c;var f="suspendedStart",d="suspendedYield",h="executing",g="completed",v={};function m(){}function q(){}function w(){}var j={};p(j,a,(function(){return this}));var A=Object.getPrototypeOf,I=A&&A(A(D([])));I&&I!==r&&n.call(I,a)&&(j=I);var x=w.prototype=m.prototype=Object.create(j);function H(e){["next","throw","return"].forEach((function(t){p(e,t,(function(e){return this._invoke(t,e)}))}))}function J(e,t){function r(o,i,a,s){var u=l(e[o],e,i);if("throw"!==u.type){var p=u.arg,c=p.value;return c&&"object"==y(c)&&n.call(c,"__await")?t.resolve(c.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(c).then((function(e){p.value=e,a(p)}),(function(e){return r("throw",e,a,s)}))}s(u.arg)}var i;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return i=i?i.then(o,o):o()}})}function C(t,r,n){var o=f;return function(i,a){if(o===h)throw Error("Generator is already running");if(o===g){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var u=W(s,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===f)throw o=g,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var p=l(t,r,n);if("normal"===p.type){if(o=n.done?g:d,p.arg===v)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=g,n.method="throw",n.arg=p.arg)}}}function W(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,W(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=l(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function U(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function D(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}throw new TypeError(y(t)+" is not iterable")}return q.prototype=w,o(x,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:q,configurable:!0}),q.displayName=p(w,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===q||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,p(e,u,"GeneratorFunction")),e.prototype=Object.create(x),e},t.awrap=function(e){return{__await:e}},H(J.prototype),p(J.prototype,s,(function(){return this})),t.AsyncIterator=J,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new J(c(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},H(x),p(x,u,"Generator"),p(x,a,(function(){return this})),p(x,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=D,U.prototype={constructor:U,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(O),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),p=n.call(a,"finallyLoc");if(u&&p){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!p)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),O(r),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;O(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:D(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),v}},t}function m(e,t,r,n,o,i,a){try{var s=e[i](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function q(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){m(i,n,o,a,s,"next",e)}function s(e){m(i,n,o,a,s,"throw",e)}a(void 0)}))}}function w(e){var t=null;try{t=e.responseText,e.responseJSON&&(t=e.responseJSON)}catch(e){}return t}function j(e,t){this.api=e,this.baseUrlApi=d.d.getApiUrl(),(0,i.gN)(t.baseUrlApi)&&(this.baseUrlApi=t.baseUrlApi)}j.prototype.createJob=function(e){var t=this.api;(0,i.Q2)(e)||(e={});var r=v.extend({},t.baseAjaxOptions);r.url=this.baseUrlApi+"/api/jobs?async=true",r.data=e;var n=v.Deferred(),o=this;return t.ajaxWrapper.postJson(r).done((function(e,r,i){e=l(e),o.getJobInfoUntilStatus(e.sat.id_job,"incomplete",10,!0).done((function(r){var o=new s.I(r);if(!o.isValid())return a.q.log("qgApiHelper createJob fail broken response",{info:"response: "+JSON.stringify(e)}),void n.reject(f.mV);var i=r,u=o.getId();t.jobCache.setData(u,i),a.q.addLogData("job_id",u),a.q.log("qgApiHelper createJob done"),n.resolve(i)})).fail((function(e,t){if(e===f.tW)return a.q.log("qgApiHelper createJob fail - payment required"),void n.reject(f.tW,t);n.reject(f.dz)}))})).fail((function(e,t,r){if(402===e.status)return a.q.log("qgApiHelper createJob fail - payment required"),void n.reject(f.tW,w(e));n.reject(f.dz)})),n},j.prototype.getJobInfo=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];(0,n.U7)(e);var o=this.api,i=v.Deferred(),s=v.extend({},o.baseAjaxOptions);s.url=this.baseUrlApi+"/api/jobs/"+e,!0===t&&!1===r&&(s.url+="?async=true"),!0===r&&(s.url+="?sync=true"),o.numberOfCurrentJobInfoRequests.hasOwnProperty(e)||(o.numberOfCurrentJobInfoRequests[e]=0),o.numberOfCurrentJobInfoRequests[e]++;return o.ajaxWrapper.get(s).done((function(t,r,n){o.numberOfCurrentJobInfoRequests[e]--;var a=t=l(t);o.jobCache.setData(e,a),i.resolve(a)})).fail((function(t,r,n){return o.numberOfCurrentJobInfoRequests[e]--,402===t.status?(a.q.log("qgApiHelper getJobInfo fail payment required",t.status),void i.reject(f.tW,w(t))):404===t.status?(a.q.log("qgApiHelper getJobInfo fail job not found",t.status),void i.reject(f.T0)):(a.q.log("qgApiHelper getJobInfo fail connection problem",t.status),void i.reject(f.dz))})),i},j.prototype.getJobInfoUntilStatus=function(e,t,r,o){(0,n.U7)(e),(0,i.h7)(o)&&(o=!0),(0,i.ym)(r)||(r=10),(0,n.Ye)(r),(0,n.jO)(r>0);var s=v.Deferred(),u=0,p=this;return function n(){if(u>r)return a.q.log("qgApiHelper getJobInfoUntilStatus fail - no more retries"),void s.reject(f.ww);p.getJobInfo(e,o).done((function(e){if(e.status.code!==t){var r=2e3;"init"===e.status.code&&(r=1e3),u++,setTimeout(n,r)}else s.resolve(e)})).fail((function(e,t){if(e===f.tW)return a.q.log("qgApiHelper getJobInfoWithRetries getJobInfo fail - payment required",e),void s.reject(f.tW,t);u++,setTimeout(n,2e3)}))}(),s},j.prototype.getJobInfoWithRetries=function(e,t){(0,n.U7)(e),(0,i.ym)(t)||(t=5),(0,n.Ye)(t),(0,n.jO)(t>0);var r=v.Deferred(),o=0,s=this;return function n(){if(o>t)return a.q.log("qgApiHelper getJobInfoWithRetries fail - no more retries"),void r.reject(f.ww);s.getJobInfo(e).done((function(e){r.resolve(e)})).fail((function(e,t){if(e===f.tW)return a.q.log("qgApiHelper getJobInfoWithRetries getJobInfo fail - payment required"),void r.reject(f.tW,t);o++,setTimeout(n,2e3)}))}(),r},j.prototype.addInput=function(e,t){(0,n.U7)(e),(0,n.OA)(t),(0,n.Fm)(t),(0,n.B$)(t,"type");var r=this.api,o=v.Deferred(),i=v.extend({},r.baseAjaxOptions);i.url=this.baseUrlApi+"/api/jobs/"+e+"/input",i.data=t;return r.ajaxWrapper.postJson(i).done((function(e,t,r){var n=e=l(e);a.q.log("qgApiHelper addJobInput done",JSON.stringify(n)),o.resolve(n)})).fail((function(e,t,r){return 0===e.status?(a.q.log("qgApiHelper addJobInput fail connection problem",e.status),void o.reject(f.dz)):402===e.status?(a.q.log("qgApiHelper addJobInput fail payment required"),void o.reject(f.tW,w(e))):(a.q.log("qgApiHelper addJobInput fail connection problem",e.status),void o.reject(f.ph))})),o},j.prototype.addInputWithCheck=function(e,t,r){(0,n.U7)(e),(0,n.OA)(t),(0,n.Fm)(t),(0,n.B$)(t,"type"),(0,n.Ye)(r),(0,n.jO)(r>=0);var o=v.Deferred(),i=0,s=this;function u(){if(i>5)return a.q.log("qgApiHelper addInputWithCheck fail - too many retries"),void o.reject(f.ww);s.addInput(e,t).done((function(t){s.getJobInfoUntilInputCount(e,r+1).done((function(){o.resolve(t)})).fail((function(e,t){if(e===f.tW)return a.q.log("qgApiHelper addInputWithCheck fail - payment required"),void o.reject(f.tW,t);a.q.log("qgApiHelper addInputWithCheck fail",e),o.reject(f.ph)}))})).fail((function(t,n){if(t!==f.dz){if(t===f.tW)return a.q.log("qgApiHelper addInputWithCheck fail - payment required"),void o.reject(f.tW,n);a.q.log("qgApiHelper addInputWithCheck fail"),o.reject(t)}else s.getJobInfoWithRetries(e,3).done((function(e){var t=e.input.length;return t===r?(a.q.log("qgApiHelper addInputWithCheck retry"),void setTimeout(u,2e3)):t===r+1?(a.q.log("qgApiHelper addInputWithCheck done - with retry"),void o.resolve(e.input[t-1])):(a.q.log("qgApiHelper addInputWithCheck fail","wrong number of inputs"),void o.reject(f.ph))})).fail((function(e,t){if(e===f.tW)return a.q.log("qgApiHelper addInputWithCheck fail - payment required"),void o.reject(f.tW,t);a.q.log("qgApiHelper addInputWithCheck fail",e),o.reject(f.ph)}))})),i++}return u(),o},j.prototype.addInputs=function(e,t){(0,n.U7)(e),(0,n.OA)(t);var r=this.api,o=v.Deferred(),s=v.extend({},r.baseAjaxOptions);s.url=this.baseUrlApi+"/api/jobs/"+e+"/input",s.data=t;return r.ajaxWrapper.postJson(s).done((function(e,r,n){var s=e=l(e);if(!new c((0,i.m5)(s)?s[0]:s).isValid())return a.q.log("qgApiHelper addJobInput fail broken response",{info:"response: "+JSON.stringify(s)}),void o.reject(f.mV);a.q.log("qgApiHelper addJobInput done",JSON.stringify(t)),o.resolve(s)})).fail((function(e,t,r){if(402===e.status)return a.q.log("qgApiHelper addJobInput fail payment required"),void o.reject(f.tW,w(e));a.q.log("qgApiHelper addJobInput fail connection problem",e.status),o.reject(f.dz)})),o},j.prototype.addConversion=function(e,t){(0,n.U7)(e),(0,n.OA)(t);var r=this.api,o=v.Deferred(),s=v.extend({},r.baseAjaxOptions);s.url=this.baseUrlApi+"/api/jobs/"+e+"/conversions",s.data=t;return r.ajaxWrapper.postJson(s).done((function(e,r,n){e=l(e),a.q.log("qgApiHelper addConversion done",JSON.stringify(t)),o.resolve(e)})).fail((function(e,t,r){var n=function(e){if(!(0,i.Q2)(e))return null;if(!(0,i.Q2)(e.responseJSON))return null;var t=e.responseJSON;return(0,i.bV)(t,"code")&&(0,i.bV)(t,"message")?{code:t.code,message:t.message}:null}(e);if(n){if(2===n.code)return a.q.log("qgApiHelper addConversion fail - invalid conversion option",{http_status:e.status,info:"conversion options: "+JSON.stringify(s)}),void o.reject(f.oo);if(2002===n.code)return a.q.log("qgApiHelper addConversion fail - job can not be modified",{http_status:e.status,info:"conversion options: "+JSON.stringify(s)}),void o.reject(f.R1)}return 0===e.status?(a.q.log("qgApiHelper addConversion fail - connection problem",e.status),void o.reject(f.dz)):402===e.status?(a.q.log("qgApiHelper addConversion fail - payment required"),void o.reject(f.tW,w(e))):(a.q.log("qgApiHelper addConversion fail - unknown",e.status),void o.reject(f.ph))})),o},j.prototype.addConversionWithCheck=function(e,t){(0,n.U7)(e);var r=v.Deferred(),o=this,s=0;function u(){if(s>5)return a.q.log("qgApiHelper addConversionWithCheck fail - too many retries"),void r.reject(f.ww);o.getJobInfoWithRetries(e,5).done((function(e){if((0,i.m5)(e.conversion)){if(0===e.conversion.length)return a.q.log("qgApiHelper addConversionWithCheck retry - no conversion"),void setTimeout(u,1e3);if(1===e.conversion.length)return a.q.log("qgApiHelper addConversionWithCheck done - after fail"),void r.resolve(e.conversion[0]);a.q.log("qgApiHelper addConversionWithCheck fail - too many conversions"),r.reject(f.ph)}})).fail((function(e,t){if(e===f.tW)return a.q.log("qgApiHelper addConversionWithCheck fail - payment required"),void r.reject(f.tW,t);a.q.log("qgApiHelper addConversionWithCheck fail - fail in getjobinfo"),r.reject(f.ph)})),s++}return function n(){if(s>5)return a.q.log("qgApiHelper addConversionWithCheck fail - too many retries"),void r.reject(f.ww);o.addConversion(e,t).done((function(e){u()})).fail((function(e,t){if(e===f.tW)return a.q.log("qgApiHelper addConversionWithCheck fail - payment required"),void r.reject(f.tW,t);e===f.dz||e===f.ph?n():r.reject(e)})),s++}(),r},j.prototype.startJob=function(e,t){(0,n.U7)(e);var r=v.Deferred();return r.reject(f.Bn),r},j.prototype.deleteInput=function(e,t){(0,n.U7)(e),(0,n.U7)(t);var r=this.api,o=v.Deferred(),i=v.extend({},r.baseAjaxOptions);i.url=this.baseUrlApi+"/api/jobs/"+e+"/input/"+t+"/delete",i.data=v.extend({},r.baseData);return r.ajaxWrapper.postJson(i).done((function(e,r,n){e=l(e),a.q.log("qgApiHelper deleteInput done",t),o.resolve(e)})).fail((function(e,t,r){if(402===e.status)return a.q.log("qgApiHelper deleteInput fail payment required",e.status),void o.reject(f.tW,w(e));a.q.log("qgApiHelper deleteInput fail connection problem",e.status),o.reject(f.dz)})),o},j.prototype.cancelJob=function(e){(0,n.U7)(e);var t=this.api,r=v.Deferred(),o=v.extend({},t.baseAjaxOptions);o.url=this.baseUrlApi+"/api/jobs/"+e+"/cancel";return t.ajaxWrapper.postJson(o).done((function(t,n,o){t=l(t),a.q.log("qgApiHelper cancelJob done",e),r.resolve(t)})).fail((function(e,t,n){a.q.log("qgApiHelper cancelJob fail",e.status),r.reject(f.jl,w(e))})),r},j.prototype.deleteInputAndWait=function(e,t){var r=this;(0,n.U7)(e),(0,n.U7)(t);this.api;var o=v.Deferred();return this.deleteInput(e,t).done((function(){r.getJobInfoUntilInputIsDeleted(e,t).done((function(){o.resolve()})).fail((function(e,t){if(e===f.tW)return a.q.log("qgApiHelper delete input and wait fail - payment required"),void o.reject(f.tW,t);a.q.log("qgApiHelper delete input and wait fail connection problem",e),o.reject(f.dz)}))})).fail((function(e,t){if(a.q.log("qgApiHelper delete input and wait fail connection problem",e),e===f.tW)return a.q.log("qgApiHelper addConversionWithCheck fail - payment required"),void o.reject(f.tW,t);o.reject(f.dz)})),o},j.prototype.setPassword=function(e,t,r){(0,n.U7)(e),(0,n.U7)(t);var o=v.Deferred(),i=this.api,s=this,u=0,p=v.extend({},i.baseData,{credentials:{decrypt_password:r}}),c=v.extend({},i.baseAjaxOptions);return c.url=this.baseUrlApi+"/api/jobs/"+e+"/input/"+t+"/patch",c.data=p,this.getJobInfoUntilInput(e,t).done((function(r){u=r.modified_at,i.ajaxWrapper.postJson(c).done((function(r,n,i){r=l(r),a.q.log("qgApiHelper set password done",t),s.getUpdatedInput(e,t,u).done((function(e){a.q.log("qgApiHelper set password finished",t),o.resolve(e)})).fail((function(e,t){if(e===f.tW)return a.q.log("qgApiHelper set password fail  payment required"),void o.reject(f.tW,t);a.q.log("qgApiHelper set password fail connection problem",e),o.reject(f.dz)}))})).fail((function(e,t,r){if(402===e.status)return a.q.log("qgApiHelper set password fail payment required",e.status),void o.reject(f.tW,w(e));a.q.log("qgApiHelper set password fail connection problem",e.status),o.reject(f.dz)}))})).fail((function(e,t){if(e===f.tW)return a.q.log("qgApiHelper set password fail  payment required"),void o.reject(f.tW,t);a.q.log("qgApiHelper set password fail connection problem",e),o.reject(f.dz)})),o},j.prototype.getJobInfoUntilInput=function(e,t){var r=v.Deferred(),n=this,o=0;return function i(){n.getJobInfo(e).done((function(e){var n=e.input.find((function(e,r,n){return e.id===t}));void 0===n?(o>60&&r.reject(f.ww),++o,setTimeout(i,1e3)):r.resolve(n)})).fail((function(e,t){if(e===f.tW)return a.q.log("qgApiHelper getJobInfoUntilInput fail  payment required"),void r.reject(f.tW,t);a.q.log("qgApiHelper getJobInfoUntilInput fail connection problem",e),r.reject(f.dz)}))}(),r},j.prototype.getJobInfoUntilInputIsDeleted=function(e,t){var r=v.Deferred(),n=this,o=0;return function i(){n.getJobInfo(e).done((function(e){void 0!==e.input.find((function(e,r,n){return e.id===t}))?(o>60&&r.reject(f.ww),++o,setTimeout(i,1e3)):r.resolve()})).fail((function(e,t){a.q.log("qgApiHelper getJobInfoUntilInputIsDeleted connection problem",e),r.reject(f.dz)}))}(),r},j.prototype.getJobInfoUntilInputCount=function(e,t){var r=v.Deferred(),n=this,o=0,i=0;return function s(){n.getJobInfo(e).done((function(e){i=0,e.input.length>=t?r.resolve(e):o>60?r.reject(f.ww):(++o,setTimeout(s,1e3))})).fail((function(e,t){return e===f.tW?(a.q.log("qgApiHelper getJobInfoUntilInputCount fail payment required"),void r.reject(f.tW,t)):i<30?(i++,void setTimeout(s,3e3)):(a.q.log("qgApiHelper getJobInfoUntilInputCount fail",e),void r.reject(f.dz))}))}(),r},j.prototype.getJobInfoUntilAtLeastOneInput=function(e){var t=v.Deferred(),r=this,n=0;return function o(){r.getJobInfo(e).done((function(e){e.input.length>=1?t.resolve(e):n>60?t.reject(f.ww):(++n,setTimeout(o,1e3))})).fail((function(e,r){if(e===f.tW)return a.q.log("qgApiHelper getJobInfoUntilAtLeastOneInput fail payment required"),void t.reject(f.tW,r);a.q.log("qgApiHelper getJobInfoUntilAtLeastOneInput fail",e),t.reject(f.dz)}))}(),t},j.prototype.getUpdatedInput=function(e,t,r){var n=v.Deferred(),o=this,i=0;return function s(){o.getJobInfo(e).done((function(e){var o=e.input.find((function(e,r,n){return e.id===t}));o.modified_at>r?n.resolve(o):i>60?n.reject(f.ww):(++i,setTimeout(s,1e3))})).fail((function(e,t){if(e===f.tW)return a.q.log("qgApiHelper get updated input fail payment required"),void n.reject(f.tW,t);a.q.log("qgApiHelper get updated input fail connection problem",e),n.reject(f.dz)}))}(),n},j.prototype.createJobPromise=function(){var e=q(b().mark((function e(t){var r=this;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=q(b().mark((function e(n,o){var i,u,p,c,l,d;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.api,e.prev=1,e.next=4,h.X.post("/api/jobs?async=true",t);case 4:return u=e.sent,e.next=7,r.getJobInfoUntilStatusPromise(u.data.sat.id_job,"incomplete",10,!0);case 7:if(p=e.sent,(c=new s.I(p)).isValid()){e.next=13;break}return a.q.log("qgApiHelper createJobPromise fail broken response",{info:"response: "+JSON.stringify(u.data)}),o(f.mV),e.abrupt("return");case 13:l=p,d=c.getId(),i.jobCache.setData(d,l),a.q.addLogData("job_id",d),a.q.log("qgApiHelper createJobPromise done"),n(l),e.next=28;break;case 21:if(e.prev=21,e.t0=e.catch(1),402!==e.t0.response.status){e.next=27;break}return a.q.log("qgApiHelper createJobPromise fail - payment required"),o({message:f.tW,responseData:e.t0.response.data}),e.abrupt("return");case 27:o(f.dz);case 28:case"end":return e.stop()}}),e,null,[[1,21]])})));return function(t,r){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),j.prototype.getJobInfoPromise=function(){var e=q(b().mark((function e(t){var r,o,i=this,s=arguments;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>1&&void 0!==s[1]&&s[1],o=s.length>2&&void 0!==s[2]&&s[2],e.abrupt("return",new Promise(function(){var e=q(b().mark((function e(s,u){var p,c,l,d;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,n.U7)(t),p=i.api,c="/api/jobs/".concat(t),!0===r&&!1===o&&(c+="?async=true"),!0===o&&(c+="?sync=true"),p.numberOfCurrentJobInfoRequests.hasOwnProperty(t)||(p.numberOfCurrentJobInfoRequests[t]=0),p.numberOfCurrentJobInfoRequests[t]++,e.prev=7,e.next=10,h.X.get(c);case 10:l=e.sent,p.numberOfCurrentJobInfoRequests[t]--,d=l.data,p.jobCache.setData(t,d),s(d),e.next=30;break;case 17:if(e.prev=17,e.t0=e.catch(7),p.numberOfCurrentJobInfoRequests[t]--,402!==e.t0.response.status){e.next=24;break}return a.q.log("qgApiHelper getJobInfoPromise fail payment required",e.t0.response.data),u({message:f.tW,responseData:e.t0.response.data}),e.abrupt("return");case 24:if(404!==e.t0.response.status){e.next=28;break}return a.q.log("qgApiHelper getJobInfoPromise fail job not found",e.t0.response.data),u({message:f.T0,responseData:e.t0.response.data}),e.abrupt("return");case 28:a.q.log("qgApiHelper getJobInfoPromise fail connection problem",e.t0.response.data),u({message:f.dz,responseData:e.t0.response.data});case 30:case"end":return e.stop()}}),e,null,[[7,17]])})));return function(t,r){return e.apply(this,arguments)}}()));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),j.prototype.getJobInfoUntilStatusPromise=function(){var e=q(b().mark((function e(t,r,o,s){var u=this;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=q(b().mark((function e(p,c){var l,d,h,g;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g=function(){return(g=q(b().mark((function e(){var n,i,u;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(l>o)){e.next=4;break}return a.q.log("qgApiHelper getJobInfoUntilStatusPromise fail - no more retries"),c(f.ww),e.abrupt("return");case 4:return e.prev=4,e.next=7,d.getJobInfoPromise(t,s);case 7:if((n=e.sent).status.code!==r){e.next=11;break}return p(n),e.abrupt("return");case 11:i=2e3,"init"===n.status.code&&(i=200),l++,setTimeout(h,i),e.next=28;break;case 17:if(e.prev=17,e.t0=e.catch(4),(null===e.t0||void 0===e.t0?void 0:e.t0.message)!==f.T0){e.next=22;break}return c({message:f.T0}),e.abrupt("return");case 22:if(402!==(null===e.t0||void 0===e.t0||null===(u=e.t0.response)||void 0===u?void 0:u.status)){e.next=26;break}return a.q.log("qgApiHelper getJobInfoWithRetries getJobInfoUntilStatusPromise fail - payment required",e.t0.response.data),c({message:f.tW,responseData:e.t0.response.data}),e.abrupt("return");case 26:l++,setTimeout(h,2e3);case 28:case"end":return e.stop()}}),e,null,[[4,17]])})))).apply(this,arguments)},h=function(){return g.apply(this,arguments)},(0,i.h7)(s)&&(s=!0),(0,i.ym)(o)||(o=5),(0,n.Ye)(o),(0,n.jO)(o>0),l=0,d=u,e.prev=8,e.next=11,h();case 11:e.next=17;break;case 13:e.prev=13,e.t0=e.catch(8),402===e.t0.response.status&&(a.q.log("qgApiHelper getJobInfoWithRetries getJobInfoUntilStatusPromise fail - payment required",e.t0.response.data),c({message:f.tW,responseData:e.t0.response.data})),404===e.t0.response.status&&c({message:f.T0});case 17:case"end":return e.stop()}}),e,null,[[8,13]])})));return function(t,r){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(t,r,n,o){return e.apply(this,arguments)}}(),j.prototype.addConversionWithCheckPromise=function(e,t){var r=this;return new Promise(function(){var o=q(b().mark((function o(s,u){var p,c,l,d,h,g;return b().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return g=function(){return(g=q(b().mark((function r(){var n;return b().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!(c>5)){r.next=4;break}return a.q.log("qgApiHelper addConversionWithCheckPromise fail - too many retries"),u(f.ww),r.abrupt("return");case 4:return r.prev=4,r.next=7,p.addConversionPromise(e,t);case 7:n=r.sent,s(n),r.next=23;break;case 11:if(r.prev=11,r.t0=r.catch(4),404!==r.t0.response.status){r.next=17;break}return a.q.log("qgApiHelper addConversionWithCheckPromise fail - payment required"),u({message:f.tW,responseData:r.t0.response.data}),r.abrupt("return");case 17:if(!(r.t0===f.dz||r.t0===f.ph)){r.next=22;break}return r.next=21,l();case 21:return r.abrupt("return");case 22:u(r.t0.message);case 23:c++;case 24:case"end":return r.stop()}}),r,null,[[4,11]])})))).apply(this,arguments)},h=function(){return g.apply(this,arguments)},d=function(){return(d=q(b().mark((function t(){var r;return b().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.getJobInfoWithRetriesPromise(e,5);case 2:if(r=t.sent,t.prev=3,!(0,i.m5)(r.conversion)){t.next=15;break}if(0!==r.conversion.length){t.next=9;break}return a.q.log("qgApiHelper addConversionWithCheckPromise retry - no conversion"),setTimeout(h,2e3),t.abrupt("return");case 9:if(1!==r.conversion.length){t.next=13;break}return a.q.log("qgApiHelper addConversionWithCheckPromise done - after fail"),s(r.conversion[0]),t.abrupt("return");case 13:a.q.log("qgApiHelper addConversionWithCheckPromise fail - too many conversions"),u(f.ph);case 15:t.next=25;break;case 17:if(t.prev=17,t.t0=t.catch(3),402!==t.t0.response.status){t.next=23;break}return a.q.log("qgApiHelper addConversionWithCheckPromise fail - payment required"),u({message:f.tW,responseData:t.t0.response.data}),t.abrupt("return");case 23:a.q.log("qgApiHelper addConversionWithCheckPromise fail - fail in getjobinfo"),u({message:f.ph,responseData:t.t0.response.data});case 25:case"end":return t.stop()}}),t,null,[[3,17]])})))).apply(this,arguments)},l=function(){return d.apply(this,arguments)},(0,n.U7)(e),p=r,c=0,o.next=9,h();case 9:case"end":return o.stop()}}),o)})));return function(e,t){return o.apply(this,arguments)}}())},j.prototype.getJobInfoWithRetriesPromise=function(){var e=q(b().mark((function e(t,r){var o=this;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,s){(0,n.U7)(t),(0,i.ym)(r)||(r=5),(0,n.Ye)(r),(0,n.jO)(r>0);var u=0,p=o;function c(){return l.apply(this,arguments)}function l(){return(l=q(b().mark((function n(){var o;return b().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(u>r)){n.next=4;break}return a.q.log("qgApiHelper getJobInfoWithRetriesPromise fail - no more retries"),s(f.ww),n.abrupt("return");case 4:return n.prev=4,n.next=7,p.getJobInfoPromise(t);case 7:o=n.sent,e(o),n.next=17;break;case 11:if(n.prev=11,n.t0=n.catch(4),402!==n.t0.response.status){n.next=17;break}return a.q.log("qgApiHelper getJobInfoWithRetriesPromise getJobInfo fail - payment required"),s({message:f.tW,responseData:n.t0.response.data}),n.abrupt("return");case 17:u++,setTimeout(c,2e3);case 19:case"end":return n.stop()}}),n,null,[[4,11]])})))).apply(this,arguments)}c()})));case 1:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),j.prototype.addConversionPromise=function(){var e=q(b().mark((function e(t,r){var o=this;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=q(b().mark((function e(i,s){var u,p,c,l;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,n.U7)(t),(0,n.OA)(r),o.api,u=o.baseUrlApi+"/api/jobs/"+t+"/conversions",p=r,o,c={headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, POST, PATCH, PUT, DELETE, OPTIONS","Access-Control-Allow-Headers":"Origin, Content-Type, X-Auth-Token","Access-Control-Allow-Credentials":!0},withCredentials:!1},e.prev=7,e.next=10,g.o.post(u,p,c);case 10:l=e.sent,a.q.log("qgApiHelper addConversionPromise done",JSON.stringify(r)),i(l.data),e.next=27;break;case 15:if(e.prev=15,e.t0=e.catch(7),0!==e.t0.response.status){e.next=21;break}return a.q.log("qgApiHelper addConversionPromise fail - connection problem",e.t0.response.status),s(f.dz),e.abrupt("return");case 21:if(402!==e.t0.response.status){e.next=25;break}return a.q.log("qgApiHelper addConversionPromise fail - payment required"),s({message:f.tW,responseData:e.t0.response.data}),e.abrupt("return");case 25:a.q.log("qgApiHelper addConversionPromise fail - unknown",e.t0.response.data),s(f.ph);case 27:case"end":return e.stop()}}),e,null,[[7,15]])})));return function(t,r){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),j.prototype.uploadBase64Promise=function(){var e=q(b().mark((function e(t,r,n){return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=q(b().mark((function e(o,i){var a,s;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, POST, PATCH, PUT, DELETE, OPTIONS","Access-Control-Allow-Headers":"Origin, Content-Type, X-Auth-Token","Access-Control-Allow-Credentials":!0,"X-Oc-Token":n},withCredentials:!1},e.prev=1,e.next=4,g.o.post(t,r,a);case 4:s=e.sent,o(s.data),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),i(e.t0);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t,r){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}();var A=r(45756);function I(e){(0,n.Ye)(e),this.maxCacheTimeSeconds=e,this.data={}}I.prototype.setData=function(e,t){(0,n.yN)(e),(0,n.jf)(t),(0,n._G)(t),this.data[e]={time_ms:Date.now(),data:t}},I.prototype.getData=function(e){return(0,n.yN)(e),this.data.hasOwnProperty(e)?!((Date.now()-this.data[e].time_ms)/1e3>this.maxCacheTimeSeconds)&&this.data[e].data:null},I.prototype.getDataEvenIfTooOld=function(e){return(0,n.yN)(e),this.data.hasOwnProperty(e)?this.data[e].data:null};var x=r(16019),H=r(74692);function J(e){return J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},J(e)}function C(){C=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function p(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{p({},"")}catch(e){p=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var i=t&&t.prototype instanceof y?t:y,a=Object.create(i.prototype),s=new U(n||[]);return o(a,"_invoke",{value:H(e,r,s)}),a}function l(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=c;var f="suspendedStart",d="suspendedYield",h="executing",g="completed",v={};function y(){}function b(){}function m(){}var q={};p(q,a,(function(){return this}));var w=Object.getPrototypeOf,j=w&&w(w(D([])));j&&j!==r&&n.call(j,a)&&(q=j);var A=m.prototype=y.prototype=Object.create(q);function I(e){["next","throw","return"].forEach((function(t){p(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function r(o,i,a,s){var u=l(e[o],e,i);if("throw"!==u.type){var p=u.arg,c=p.value;return c&&"object"==J(c)&&n.call(c,"__await")?t.resolve(c.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(c).then((function(e){p.value=e,a(p)}),(function(e){return r("throw",e,a,s)}))}s(u.arg)}var i;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return i=i?i.then(o,o):o()}})}function H(t,r,n){var o=f;return function(i,a){if(o===h)throw Error("Generator is already running");if(o===g){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var u=W(s,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===f)throw o=g,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var p=l(t,r,n);if("normal"===p.type){if(o=n.done?g:d,p.arg===v)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=g,n.method="throw",n.arg=p.arg)}}}function W(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,W(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=l(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function U(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function D(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}throw new TypeError(J(t)+" is not iterable")}return b.prototype=m,o(A,"constructor",{value:m,configurable:!0}),o(m,"constructor",{value:b,configurable:!0}),b.displayName=p(m,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,p(e,u,"GeneratorFunction")),e.prototype=Object.create(A),e},t.awrap=function(e){return{__await:e}},I(x.prototype),p(x.prototype,s,(function(){return this})),t.AsyncIterator=x,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new x(c(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},I(A),p(A,u,"Generator"),p(A,a,(function(){return this})),p(A,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=D,U.prototype={constructor:U,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(O),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),p=n.call(a,"finallyLoc");if(u&&p){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!p)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),O(r),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;O(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:D(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),v}},t}function W(e,t,r,n,o,i,a){try{var s=e[i](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function k(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){W(i,n,o,a,s,"next",e)}function s(e){W(i,n,o,a,s,"throw",e)}a(void 0)}))}}function O(e){(0,i.h7)(e)&&(e={}),this.baseApiData=null,(0,i.Q2)(e.baseApiData)&&(this.baseApiData=e.baseApiData),this.baseUrlApi=null,(0,i.gN)(e.baseUrlApi)&&(this.baseUrlApi=e.baseUrlApi),this.paymentRequiredCallback=null,(0,i.Fs)(e.paymentRequiredCallback)&&(this.paymentRequiredCallback=e.paymentRequiredCallback)}function U(e,t){(0,n.yN)(e),this.apiHelper=new j(this,t),(0,n.jf)(this.apiHelper,'type must be "sat" or "oc"'),this.ajaxWrapper=new A.C,this.jobCache=new I(2),this.numberOfCurrentJobInfoRequests={},this.baseData={},(0,i.Q2)(t.baseApiData)&&(this.baseData=t.baseApiData),this.baseAjaxOptions={dataType:"json",crossDomain:!0,xhrFields:{withCredentials:!0},cache:!1,maxRetries:3,retryTimeout:!0,retry400:!1,retry500:!0,retryOther:!0}}U.prototype.createJob=function(e){var t=this.apiHelper;try{return t.createJob(e)}catch(e){a.q.log("qgApiHelper exception",e)}var r=H.Deferred();return r.reject(f.Yl),r},U.prototype.createJobWithUploadServerCheck=function(e,t){(0,i.ym)(t)||(t=1);var r=H.Deferred(),n=this,o=0;function s(){n.apiHelper.createJob(e).done((function(e){!function(e){n.checkUploadServer(e.server).done((function(){var t=!0;r.resolve(e,t)})).fail((function(n,i){if(n!==f.tW)if(o>=t){a.q.log("qgApiHelper createJob info","no upload server found");var u=!1;r.resolve(e,u)}else{var p=1e4,c=1e3*++o;c>p&&(c=p),setTimeout((function(){s()}),c)}else r.reject(f.tW,i)}))}(e)})).fail((function(e,t){(0,x.L)(e),r.reject(e,t)}))}return s(),r},U.prototype.checkUploadServer=function(e,t){(0,n.yN)(e),(0,i.ym)(t)||(t=0);e.replace(/(\/dl.*)/,"/dl/alive"),Date.now();var r=H.Deferred();return r.resolve()},U.prototype.getJobInfo=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];(0,n.U7)(e);var o=this.apiHelper;try{return o.getJobInfo(e,t,r)}catch(e){a.q.log("qgApiHelper exception",e)}var i=H.Deferred();return i.reject(f.Yl),i},U.prototype.getJobInfoUntilStatus=function(e,t,r,o){(0,n.U7)(e);var i=this.apiHelper;try{return i.getJobInfoUntilStatus(e,t,r,o)}catch(e){a.q.log("qgApiHelper exception",e)}var s=H.Deferred();return s.reject(f.Yl),s},U.prototype.getJobInfoWithRetries=function(e,t){(0,n.U7)(e),(0,i.ym)(t)||(t=5),(0,n.Ye)(t),(0,n.jO)(t>0);var r=this.apiHelper;try{return r.getJobInfoWithRetries(e,t)}catch(e){a.q.log("qgApiHelper exception",e)}var o=H.Deferred();return o.reject(f.Yl),o},U.prototype.getCachedJobInfo=function(e){(0,n.U7)(e);var t=this.jobCache.getData(e);(0,n.jf)(t),this.numberOfCurrentJobInfoRequests.hasOwnProperty(e)||(this.numberOfCurrentJobInfoRequests[e]=0);var r=this.numberOfCurrentJobInfoRequests[e]>0;if(!1===t&&!r)return this.getJobInfo(e);var o=this.jobCache.getDataEvenIfTooOld(e),i=H.Deferred();return i.resolve(o),i},U.prototype.addInput=function(e,t){(0,n.U7)(e),(0,n.OA)(t);var r=this.apiHelper;try{return r.addInput(e,t)}catch(e){a.q.log("qgApiHelper exception",e)}var o=H.Deferred();return o.reject(f.Yl),o},U.prototype.addInputWithCheck=function(e,t,r){(0,n.U7)(e),(0,n.OA)(t),(0,n.Ye)(r),(0,n.jO)(r>=0);var o=this.apiHelper;try{return o.addInputWithCheck(e,t,r)}catch(e){a.q.log("qgApiHelper exception",e)}var i=H.Deferred();return i.reject(f.Yl),i},U.prototype.addInputsWithCheck=function(e,t,r){(0,n.U7)(e),(0,n.ys)(t),(0,n.jO)(t.length>0),(0,n.Ye)(r),(0,n.jO)(r>=0);this.apiHelper;var o=this,i=H.Deferred(),s=0,u=t.length,p=r;return function r(){o.addInputWithCheck(e,t[s],p).done((function(){s++,p++,s>=u?i.resolve():setTimeout(r,200)})).fail((function(e,t){a.q.log("qgApiHelper addInputsWithCheck fail",e),i.reject(e,t)}))}(),i},U.prototype.addInputs=function(e,t){(0,n.U7)(e);var r=this.apiHelper;try{return r.addInputs(e,t)}catch(e){a.q.log("qgApiHelper exception",e)}var o=H.Deferred();return o.reject(f.Yl),o},U.prototype.addInputId=function(e,t){(0,n.U7)(e),(0,n.U7)(t);var r={type:"input_id",source:t};return this.addInput(e,r)},U.prototype.addExternalUrl=function(e,t,r){(0,n.U7)(e),(0,n.yN)(t),(0,i.h7)(r)&&(r="auto");var o={type:"remote",source:t,engine:r};return this.addInput(e,o)},U.prototype.addConversion=function(e,t){(0,n.U7)(e);var r=this.apiHelper;try{return r.addConversion(e,t)}catch(e){a.q.log("qgApiHelper exception",e)}var o=H.Deferred();return o.reject(f.Yl),o},U.prototype.addConversionWithCheck=function(e,t){(0,n.U7)(e);var r=this.apiHelper;try{return r.addConversionWithCheck(e,t)}catch(e){a.q.log("qgApiHelper exception",e)}var o=H.Deferred();return o.reject(f.Yl),o},U.prototype.startJob=function(e,t){(0,n.U7)(e);var r=this.apiHelper;try{return r.startJob(e,t)}catch(e){a.q.log("qgApiHelper exception",e)}var o=H.Deferred();return o.reject(f.Yl),o},U.prototype.deleteInput=function(e,t){(0,n.U7)(e),(0,n.U7)(t);var r=this.apiHelper;try{return r.deleteInput(e,t)}catch(e){a.q.log("qgApiHelper exception",e)}var o=H.Deferred();return o.reject(f.Yl),o},U.prototype.cancelJob=function(e){(0,n.U7)(e);var t=this.apiHelper;try{return t.cancelJob(e)}catch(e){a.q.log("qgApiHelper exception",e)}var r=H.Deferred();return r.reject(f.Yl),r},U.prototype.deleteInputAndWait=function(e,t){(0,n.U7)(e),(0,n.U7)(t);var r=this.apiHelper;try{return r.deleteInputAndWait(e,t)}catch(e){a.q.log("qgApiHelper exception",e)}var o=H.Deferred();return o.reject(f.Yl),o},U.prototype.setPassword=function(e,t,r){(0,n.U7)(e),(0,n.U7)(t),(0,n.cI)(r);var o=this.apiHelper;try{return o.setPassword(e,t,r)}catch(e){a.q.log("qgApiHelper exception",e)}var i=H.Deferred();return i.reject(f.Yl),i},U.prototype.getJobInfoUntilInputCount=function(e,t){(0,n.U7)(e);var r=this.apiHelper;try{return r.getJobInfoUntilInputCount(e,t)}catch(e){a.q.log("qgApiHelper exception",e)}var o=H.Deferred();return o.reject(f.Yl),o},U.prototype.getJobInfoUntilAtLeastOneInput=function(e){(0,n.U7)(e);var t=this.apiHelper;try{return t.getJobInfoUntilAtLeastOneInput(e)}catch(e){a.q.log("qgApiHelper exception",e)}var r=H.Deferred();return r.reject(f.Yl),r},U.prototype.waitForRemoteInput=function(e,t){(0,n.U7)(e),(0,n.U7)(t);var r=this,i=H.Deferred(),u=Date.now();function c(){var e=(Date.now()-u)/1e3,t=5e3;e<10?t=1e3:e<30?t=2e3:e<60&&(t=3e3),setTimeout(d,t)}function l(r){var n=(Date.now()-u)/1e3,o=new s.I(r),l=o.getInput(t);if(null===l)return n>10&&a.q.log("qgApiHelper waitForRemoteInput info",{info:"input id missing from job",input_id:t,job_id:e,job_info:JSON.stringify(r),duration_s:n}),void c();if(o.isInputDownloading(t))c();else{if(o.isInputReady(t))return i.resolve(l),void a.q.log("qgApiHelper waitForRemoteInput done",{input_id:t,job_id:e,duration_s:n});var d={code:0,message:"should never happen"},h=o.getInputError(t),g=o.getInputWarning(t);null!==h?d=h:null!==g?d=g:l.status===p.tH?d={code:0,message:"server response is missing input warnings and input errrors"}:l.status===p.Z4&&(d={code:0,message:"input was canceled"});var v=function(r,n,o){a.q.log("qgApiHelper waitForRemoteInput fail",{info:JSON.stringify(r),input_id:t,job_id:e,job_info:JSON.stringify(n),duration_s:o});var i=f.ph;return 50===r.code||34===r.code?i=f.r3:10===r.code&&(i=f.dT),(0,x.L)(i),i}(d,r,n);(0,x.L)(v),i.reject(v)}}function d(){r.getCachedJobInfo(e).done((function(e){(0,o.CP)(e),l(e)})).fail((function(r,n){(0,x.L)(r),r!==f.tW?(a.q.log("qgApiHelper waitForRemoteInput retry",{info:"error: "+r,job_id:e,input_id:t}),c()):i.reject(r,n)}))}return d(),i},U.prototype.savePreset=function(e){var t=this.apiHelper;try{return t.savePreset(e)}catch(e){a.q.log("qgApiHelper exception",e)}var r=H.Deferred();return r.reject(f.Yl),r},U.prototype.waitForCompletedJob=function(e){var t=H.Deferred(),r=Date.now(),n=0;var o=this;return function i(){n>5?t.reject(f.ww):o.getJobInfoWithRetries(e,3).done((function(n){var o=Date.now()-r,s=n.status.code;if("completed"!==s){if("failed"===s)return a.q.log("qgApiHelper waitForCompletedJob - job is failed",{job_id:e}),void t.reject(f.j6);if(("incomplete"===s||"ready"===s)&&o>4e3)return a.q.log("qgApiHelper waitForCompletedJob - job has unextected status",{job_id:e,info:"status: "+s}),void t.reject(f.j6);var u=function(e){var t=500;return e>2e3&&(t=1e3),e>5e3&&(t=2e3),e>1e4&&(t=3e3),t}(o);setTimeout(i,u)}else t.resolve(n)})).fail((function(e,r){e!==f.tW?(n++,setTimeout(i,5e3)):t.reject(f.tW,r)}))}(),t},U.prototype.createJobAndConversion=function(e,t){var r=H.Deferred(),n=this;return this.createJob(e).done((function(e){n.addConversionWithCheck(e.id,t).done((function(t){r.resolve(e)})).fail((function(e,t){e!==f.tW?r.reject(f.ph,t):r.reject(f.tW,t)}))})).fail((function(e,t){e!==f.tW?r.reject(f.ph,t):r.reject(f.tW,t)})),r},U.prototype.createThumbnailFromInputId=function(e,t){var r=H.Deferred();(0,i.h7)(t)&&(t=200);var n={category:"operation",target:"thumbnail",options:{thumbnail_target:"jpg",width:t,allow_multiple_outputs:!0,pages:"1"}},o=this;return this.createJobAndConversion({operation:"thumbnail system"},n).done((function(t){o.addInputId(t.id,e).done((function(e){o.waitForCompletedJob(t.id).done((function(e){r.resolve(e.output[0].uri)})).fail((function(e,t){e!==f.tW?r.reject(f.ph):r.reject(f.tW,t)}))})).fail((function(e,t){e!==f.tW?r.reject(f.ph):r.reject(f.tW,t)}))})).fail((function(e,t){e!==f.tW?r.reject(f.ph):r.reject(f.tW,t)})),r},U.prototype.createJobPromise=function(){var e=k(C().mark((function e(t){var r=this;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=k(C().mark((function e(n,o){var i,s;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.apiHelper,e.prev=1,e.next=4,i.createJobPromise(t);case 4:s=e.sent,n(s),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),a.q.log("qgApiHelper exception",e.t0),o(e.t0);case 12:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t,r){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),U.prototype.addConversionWithCheckPromise=function(){var e=k(C().mark((function e(t,r){var o=this;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,i){(0,n.U7)(t);var s=o.apiHelper;try{s.addConversionWithCheckPromise(t,r),e()}catch(e){a.q.log("qgApiHelper exception",e),i(f.Yl)}})));case 1:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),U.prototype.uploadBase64Promise=function(){var e=k(C().mark((function e(t,r,n){var o=this;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=k(C().mark((function e(i,s){var u,p;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=o.apiHelper,e.prev=1,e.next=4,u.uploadBase64Promise(t,r,n);case 4:p=e.sent,i(p),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),s(f.Yl),a.q.log("qgApiHelper exception",e.t0);case 12:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t,r){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),U.prototype.getJobInfoUntilStatusPromise=function(){var e=k(C().mark((function e(t,r,n,o){var i=this;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=k(C().mark((function e(s,u){var p,c;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p=i.apiHelper,e.prev=1,e.next=4,p.getJobInfoUntilStatusPromise(t,r,n,o);case 4:c=e.sent,s(c),e.next=13;break;case 8:e.prev=8,e.t0=e.catch(1),(null===e.t0||void 0===e.t0?void 0:e.t0.message)===f.T0&&u(f.T0),u(f.Yl),a.q.log("qgApiHelper exception",e.t0);case 13:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t,r){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(t,r,n,o){return e.apply(this,arguments)}}();var D=function(e){return(0,n.OA)(e),new U("sat",e)}}}]);